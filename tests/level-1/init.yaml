name: "collection init"
level: 1
category: config
spec_ref: "ยง12.11, ยง5.8"

groups:
  - name: "init creates config and meta type"
    setup:
      config: null
      files: {}

    tests:
      - name: "init creates mdbase.yaml and meta type file"
        operation: init
        input: {}
        expect:
          config_path: "mdbase.yaml"
          types_folder: "_types"
          meta_type_path: "_types/meta.md"
        verify_after:
          operation: read
          input:
            path: "_types/meta.md"
          expect:
            frontmatter:
              name: meta

      - name: "meta type includes required schema fields"
        operation: read
        input:
          path: "_types/meta.md"
        expect:
          frontmatter:
            name: meta
            match:
              path_glob: "_types/**/*.md"
            strict: false
            fields:
              name:
                type: string
              fields:
                type: any

  - name: "init with custom types folder"
    setup:
      config: null
      files: {}

    tests:
      - name: "init writes meta type to custom types folder"
        operation: init
        input:
          config:
            spec_version: "0.2.0"
            settings:
              types_folder: "schemas"
        expect:
          types_folder: "schemas"
          meta_type_path: "schemas/meta.md"
        verify_after:
          operation: read
          input:
            path: "schemas/meta.md"
          expect:
            frontmatter:
              name: meta
              match:
                path_glob: "schemas/**/*.md"
